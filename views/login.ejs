<%- include('partials/header'); -%>
<body>
  <form action="">
    <h2>Login up</h2>
    <div class="form">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" required />
      <div class="email-error"></div>
    </div>
    <div class="form">
      <label for="password">Password</label>
      <input type="password" id="password" name="password" required />
      <div class="password-error"></div>
    </div>
    <button type="submit">Login in</button>
  </form>
  <%-include('partials/footer'); -%>
</body>
</html>
<script>
  const form = document.querySelector('form');
  form.addEventListener('submit', async function (event) {
    event.preventDefault();

    // reset error messages
    document.querySelector('.email-error').textContent = '';
    document.querySelector('.password-error').textContent = '';
    // get form data
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    try {
          const response = await fetch('/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password }),
        });
          const user = await response.json();
                if (response.ok) {
                  console.log('login successful');
                  location.assign('/');
                  console.log(user);
                } else {
                  console.error('Login failed');
                  console.error(user);
                  const errorr=document.querySelector('.email-error');
                  errorr.textContent = user.errors.email;
                  const errorrs=document.querySelector('.password-error');
                  errorrs.textContent = user.errors.password ;
                  setTimeout(() => {
                    console.log(user.errors.message);
                    if (user.errors.message.includes("not registered")) {
                      location.assign("/signup")}
                  }, 3000);

                }
    } 
    catch (error) {
      console.error('Error:',error);
      document.querySelector('.email-error').textContent = ('An error occurred while logging in,  try again.');
    
    }
  
  });
</script>